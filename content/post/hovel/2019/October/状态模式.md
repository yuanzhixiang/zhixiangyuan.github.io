---
title: "状态模式"
date: 2019-10-12T14:49:43+08:00
keywords: []
description: ""
tags: [
    "设计模式"
]
categories: [
]
autoCollapseToc: false
author: "yuanzx"
---

状态模式就是将状态抽象成一个接口，这样就可以通过实现不同的状态来对类做不同的操作，而不这样写则会依赖 if else，对于状态很多的情况扩展能力没有这种好。

# 1 实现代码

```java
// 抽象出状态接口
public interface ConnectState {
    void handleRequest();
}

// 实现需要根据状态改变的类
public class ConnectMachine {

    private ConnectState initState;
    private ConnectState connectingState;
    private ConnectState reconnectState;
    private ConnectState disConnectState;
    private ConnectState connectSuccessState;
    private ConnectState connectFailureState;

    public ConnectMachine() {
        initState = new InitState(this);
        connectingState = new ConnectingState(this);
        reconnectState = new ReConnectingState(this);
        disConnectState = new DisconnectState(this);
        connectSuccessState = new ConnectSuccessState(this);
        connectFailureState = new ConnectFailureState(this);
    }

    public void doConnect() {
        initState.handleRequest();
    }

    public void waitingConnect() {
        connectingState.handleRequest();
    }

    public void reConnect() {
        reconnectState.handleRequest();
    }

    public void disConnect() {
        disConnectState.handleRequest();
    }

    public void connectSuccess() {
        connectSuccessState.handleRequest();
    }

    public void connectFailure() {
        connectFailureState.handleRequest();
    }
}

// 实现各种状态
public class InitState implements ConnectState{

    private ConnectMachine connectMachine;

    private boolean connectResult;

    public InitState(ConnectMachine connectMachine) {
        this.connectMachine = connectMachine;
    }

    @Override
    public void handleRequest() {
        doConnect();
        connectMachine.waitingConnect();
    }

    private void doConnect() {
        //connect server
        if (connectResult) {
            connectSuccess();
        } else {
            connectFailure();
        }
    }

    private void connectSuccess() {
        connectMachine.connectSuccess();
    }

    private void connectFailure() {
        connectMachine.connectFailure();
    }
}

public class ReConnectingState implements ConnectState{

    private ConnectMachine connectMachine;

    public ReConnectingState(ConnectMachine connectMachine) {
        this.connectMachine = connectMachine;
    }

    @Override
    public void handleRequest() {
        reConnect();
    }

    private void reConnect() {
        //disconnect old connect and connect again
        connectMachine.disConnect();
        connectMachine.doConnect();
    }
}

public class DisconnectState implements ConnectState {

    private ConnectMachine connectMachine;

    public DisconnectState(ConnectMachine connectMachine) {
        this.connectMachine = connectMachine;
    }

    @Override
    public void handleRequest() {
        disConnect();
    }

    private void disConnect() {
        //do something
    }
}

public class ConnectingState implements ConnectState{

    private ConnectMachine connectMachine;

    public ConnectingState(ConnectMachine connectMachine) {
        this.connectMachine = connectMachine;
    }

    @Override
    public void handleRequest() {
        waitingConnect();
    }

    private void waitingConnect() {
        //loading and do something
    }
}

public class ConnectSuccessState implements ConnectState{

    private ConnectMachine connectMachine;

    public ConnectSuccessState(ConnectMachine connectMachine) {
        this.connectMachine = connectMachine;
    }

    @Override
    public void handleRequest() {
        connectSuccess();
    }

    private void connectSuccess() {
        //do something
        System.out.println("connect success.");
    }
}

public class ConnectFailureState implements ConnectState{

    private ConnectMachine connectMachine;

    public ConnectFailureState(ConnectMachine connectMachine) {
        this.connectMachine = connectMachine;
    }

    @Override
    public void handleRequest() {
        connectFailure();
    }

    private void connectFailure() {
        //do something
        System.out.println("connect fail.");
    }
}

// 测试类试一下效果
public class Main {
    public static void main(String[] args) {
        ConnectMachine connectMachine = new ConnectMachine();
        connectMachine.doConnect();
    }
}
```

# 参考资料

1. [java 状态模式实例解析](https://www.jianshu.com/p/09f4d555e8b4)
